/*! dustjs-helpers - v1.6.3
* https://github.com/linkedin/dustjs-helpers
* Copyright (c) 2015 Aleksander Williams; Released under the MIT License */
!function(a,b){"function"==typeof define&&define.amd&&define.amd.dust===!0?define(["dust.core"],b):"object"==typeof exports?module.exports=b(require("dustjs-linkedin")):b(a.dust)}(this,function(dust){function a(a){i[a]||(h(a,"Deprecation warning: "+a+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),h(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+a.replace(/\W+/g,""),"WARN"),i[a]=!0)}function b(a){return a.stack.tail&&a.stack.tail.head&&"undefined"!=typeof a.stack.tail.head.__select__}function c(a){return b(a)&&a.get("__select__")}function d(a,b){var c=a.stack.head,d=a.rebase();return a.stack&&a.stack.tail&&(d.stack=a.stack.tail),d.push({__select__:{isResolved:!1,isDefaulted:!1,isDeferredComplete:!1,deferreds:[],key:b}}).push(c,a.stack.index,a.stack.of)}function e(a,b){return"function"==typeof b?b.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):b}function f(a,b,d,e,f){e=e||{};var i,j,k=d.block,l=c(b),m=e.filterOpType||"";if(e.hasOwnProperty("key"))i=dust.helpers.tap(e.key,a,b);else{if(!l)return h(m,"No key specified","WARN"),a;i=l.key,l.isResolved&&(f=function(){return!1})}return j=dust.helpers.tap(e.value,a,b),f(g(j,e.type,b),g(i,e.type,b))?(l&&("default"===m&&(l.isDefaulted=!0),l.isResolved=!0),k?a.render(k,b):a):d["else"]?a.render(d["else"],b):a}function g(a,b,c){if("undefined"!=typeof a)switch(b||typeof a){case"number":return+a;case"string":return String(a);case"boolean":return a="false"===a?!1:a,Boolean(a);case"date":return new Date(a);case"context":return c.get(a)}return a}var h=dust.log?function(a,b,c){c=c||"INFO",a=a?"{@"+a+"}: ":"",dust.log(a+b,c)}:function(){},i={},j={tap:function(b,c,d){if(a("tap"),"function"!=typeof b)return b;var e,f="";return e=c.tap(function(a){return f+=a,""}).render(b,d),c.untap(),e.constructor!==c.constructor?e:""===f?!1:f},sep:function(a,b,c){var d=c.block;return b.stack.index===b.stack.of-1?a:d?d(a,b):a},first:function(a,b,c){return 0===b.stack.index?c.block(a,b):a},last:function(a,b,c){return b.stack.index===b.stack.of-1?c.block(a,b):a},contextDump:function(a,b,c,d){var f,g=d||{},i=g.to||"output",j=g.key||"current";return i=dust.helpers.tap(i,a,b),j=dust.helpers.tap(j,a,b),f="full"===j?JSON.stringify(b.stack,e,2):JSON.stringify(b.stack.head,e,2),"console"===i?(h("contextDump",f),a):(f=f.replace(/</g,"\\u003c"),a.write(f))},math:function(a,b,c,e){if(e&&"undefined"!=typeof e.key&&e.method){var f=e.key,g=e.method,i=e.operand,j=e.round,k=null;switch(f=parseFloat(dust.helpers.tap(f,a,b)),i=parseFloat(dust.helpers.tap(i,a,b)),g){case"mod":(0===i||i===-0)&&h("math","Division by 0","ERROR"),k=f%i;break;case"add":k=f+i;break;case"subtract":k=f-i;break;case"multiply":k=f*i;break;case"divide":(0===i||i===-0)&&h("math","Division by 0","ERROR"),k=f/i;break;case"ceil":k=Math.ceil(f);break;case"floor":k=Math.floor(f);break;case"round":k=Math.round(f);break;case"abs":k=Math.abs(f);break;case"toint":k=parseInt(f,10);break;default:h("math","Method `"+g+"` is not supported","ERROR")}return null!==k?(j&&(k=Math.round(k)),c&&c.block?(b=d(b,k),a.render(c.block,b)):a.write(k)):a}return h("math","`key` or `method` was not provided","ERROR"),a},select:function(a,b,e,f){var g,i,j,k,l=e.block;if(f.hasOwnProperty("key"))if(i=dust.helpers.tap(f.key,a,b),l){if(b=d(b,i),g=c(b),a=a.render(l,b),g.deferreds.length)for(g.isDeferredComplete=!0,k=0,j=g.deferreds.length;j>k;k++)g.deferreds[k]()}else h("select","Missing body block","WARN");else h("select","`key` is required","ERROR");return a},eq:function(a,b,c,d){return d.filterOpType="eq",f(a,b,c,d,function(a,b){return b===a})},ne:function(a,b,c,d){return d.filterOpType="ne",f(a,b,c,d,function(a,b){return b!==a})},lt:function(a,b,c,d){return d.filterOpType="lt",f(a,b,c,d,function(a,b){return a>b})},lte:function(a,b,c,d){return d.filterOpType="lte",f(a,b,c,d,function(a,b){return a>=b})},gt:function(a,b,c,d){return d.filterOpType="gt",f(a,b,c,d,function(a,b){return b>a})},gte:function(a,b,c,d){return d.filterOpType="gte",f(a,b,c,d,function(a,b){return b>=a})},any:function(a,b,d,e){var f=c(b);return f?f.isDeferredComplete?h("any","Must not be nested inside {@any} or {@none} block","ERROR"):a=a.map(function(a){f.deferreds.push(function(){f.isResolved&&!f.isDefaulted&&(a=a.render(d.block,b)),a.end()})}):h("any","Must be used inside a {@select} block","ERROR"),a},none:function(a,b,d,e){var f=c(b);return f?f.isDeferredComplete?h("none","Must not be nested inside {@any} or {@none} block","ERROR"):a=a.map(function(a){f.deferreds.push(function(){f.isResolved||(a=a.render(d.block,b)),a.end()})}):h("none","Must be used inside a {@select} block","ERROR"),a},"default":function(c,d,e,g){return g.filterOpType="default",a("default"),b(d)?f(c,d,e,g,function(){return!0}):(h("default","Must be used inside a {@select} block","ERROR"),c)},size:function(a,b,c,d){var e,f,g,h=0;if(d=d||{},e=d.key,e&&e!==!0)if(dust.isArray(e))h=e.length;else if(!isNaN(parseFloat(e))&&isFinite(e))h=e;else if("object"==typeof e){f=0;for(g in e)Object.hasOwnProperty.call(e,g)&&f++;h=f}else h=(e+"").length;else h=0;return a.write(h)}};for(var k in j)dust.helpers[k]=j[k];return dust});